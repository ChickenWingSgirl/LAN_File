<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LAN_FTP</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #000000;
            padding: 10px;
            text-align: left;
        }
        form {
            margin: 0 auto;
            text-align: center;
        }
        button {
            margin: 0 4px;
            width: 60px;
            height: 30px;
            border-radius:5px;
            background-color: rgb(0, 225, 255);
            border: 1px solid rgb(105, 105, 105);
        }
        button :hover{
            border: 0px;
        }
        #file-table{
            width: 90%;
            margin: 0 auto;
        }
        #name{
            width: 73.5%;
        }
        #file-input{
            color: rgb(0, 217, 255);
        }
        #main{
            position: absolute;
            left: 34%;
            top: 90px;
            width: 32%;
            height: 600px;
            border-radius:50px;
        }
        #kp{
            position: absolute;
            left: 34%;
            top: 90px;
            background-color: aliceblue;
            width: 32%;
            height: 600px;
            border-radius:50px;
            opacity:0.5;
        }
        body{
            background-image: url('./壁纸.png');
            background-size:100% 100%;
            background-attachment:fixed;

        }
        
    </style>
</head>
<body>
    <div id="kp">

    </div>
    <div id="main">
        <h1>局域网文件传输</h1>
    <form id="upload-form" enctype="multipart/form-data">
        <input type="file" id="file-input" name="file">
        <button type="submit">上传</button>
    </form>
    <br>
    <table id="file-table">
        <thead>
            <tr>
                <th id="name">文件名</th>
                <th id="tell">操作</th>
            </tr>
        </thead>
        <tbody id="file-list"></tbody>
    </table>
    </div>
    
    <script>
        document.getElementById('upload-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData();
            const fileInput = document.getElementById('file-input');
            formData.append('file', fileInput.files[0]);

            fetch('/upload', {
                method: 'POST',
                body: formData
            }).then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert('文件上传成功');
                    fileInput.value = ''; // 清空输入
                    loadFiles(); // 重新加载文件列表
                } else {
                    alert('文件上传失败');
                }
            }).catch(error => {
                console.error('文件上传错误:', error);
            });
        });

        function loadFiles() {
            fetch('/files')
                .then(response => response.json())
                .then(files => {
                    const fileList = document.getElementById('file-list');
                    fileList.innerHTML = ''; // 清空现有列表
                    files.forEach(file => {
                        const tr = document.createElement('tr');
                        const fileNameTd = document.createElement('td');
                        fileNameTd.textContent = file;
                        tr.appendChild(fileNameTd);

                        const actionsTd = document.createElement('td');
                        const downloadButton = document.createElement('button');
                        downloadButton.textContent = '下载';
                        downloadButton.onclick = function() {
                            window.location.href = `files/${file}`;
                        };
                        actionsTd.appendChild(downloadButton);

                        const deleteButton = document.createElement('button');
                        deleteButton.textContent = '删除';
                        deleteButton.onclick = function() {
                            fetch(`/delete?file=${encodeURIComponent(file)}`, {
                                method: 'DELETE'
                            })
                            .then(response => response.json())
                            .then(result => {
                                if (result.success) {
                                    alert('文件删除成功');
                                    loadFiles(); // 重新加载文件列表
                                } else {
                                    alert('文件删除失败');
                                }
                            }).catch(error => {
                                console.error('删除文件错误:', error);
                            });
                        };
                        actionsTd.appendChild(deleteButton);

                        tr.appendChild(actionsTd);
                        fileList.appendChild(tr);
                    });
                })
                .catch(error => {
                    console.error('获取文件列表错误:', error);
                });
        }

        // 页面加载时加载文件列表
        loadFiles();
    </script>
</body>
</html>
